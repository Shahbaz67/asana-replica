# Asana Backend Replica

A complete backend service replicating Asana's REST API, built with Python FastAPI and PostgreSQL.

## Features

This implementation covers the full Asana API including:

### VALIDATE PROJECT APIs
- I've replicated the schema for project endpoints, thought the reponse schema was not fully replicated.

### IMPORTANT POINTS:
- There are total 229 APIs in the replica as per the API reference documentation.
- Schema is generated by HTML parsing the Asana API reference documentation for each endpoint of Projects. (parser is under asana-replica/scripts/asana_api_parser.py)
- Tried replicating the reponses too, but it's failing.


### Core Resources
- **Users** - User management
- **Workspaces** - Workspace creation and management
- **Teams** - Team management within organizations
- **Projects** - Full CRUD with duplication, memberships, statuses
- **Sections** - Project sections for task organization
- **Tasks** - Complete task management with subtasks, dependencies, search
- **Stories** - Comments and activity feed
- **Attachments** - File upload support
- **Tags** - Task labeling

### Advanced Features
- **Custom Fields** - Custom field definitions with enum options
- **Portfolios** - Portfolio management with project grouping
- **Goals** - Goal tracking with metrics and relationships
- **Webhooks** - Real-time event notifications
- **Events API** - Polling-based change detection
- **Batch API** - Multiple requests in one call

### Enterprise Features
- **Audit Logs** - Activity tracking
- **Organization Exports** - Data export functionality
- **Time Periods** - Goal time period management
- **Time Tracking** - Task time entries

## Tech Stack

- **Framework**: FastAPI (Python 3.11+)
- **Database**: PostgreSQL 15+
- **ORM**: SQLAlchemy 2.0 with async support
- **Migrations**: Alembic
- **Validation**: Pydantic v2
- **Containerization**: Docker + Docker Compose

## Quick Start

### Using Docker Compose (Recommended)

1. Clone the repository:
```bash
git clone https://github.com/Shahbaz67/asana-replica.git
cd asana-replica
```

2. Start the services:
```bash
docker-compose up --build
```

3. The API will be available at:
   - API: http://localhost:8000
   - Documentation: http://localhost:8000/docs
   - ReDoc: http://localhost:8000/redoc

### Local Development

1. Create a virtual environment:
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Set up PostgreSQL and create a `.env` file:

   **Option A: Using Docker (Easiest)**
   
   Start PostgreSQL using Docker Compose (only the database service):
   ```bash
   docker-compose up db -d
   ```
   
   This will start PostgreSQL with:
   - User: `asana`
   - Password: `asana`
   - Database: `asana`
   - Port: `5432`
   
   **Option B: Install PostgreSQL Locally**
   
   - **macOS**: `brew install postgresql@15` then `brew services start postgresql@15`
   
   Create the database and user:
   ```bash
   # Connect to PostgreSQL
   psql postgres
   
   # Create database and user
   CREATE DATABASE asana;
   CREATE USER asana WITH PASSWORD 'asana';
   GRANT ALL PRIVILEGES ON DATABASE asana TO asana;
   \q
   ```
   
   **Create `.env` file:**
   
   Create a `.env` file in the project root with the following content:
   ```bash
   # Database Configuration
   DATABASE_URL=postgresql+asyncpg://asana:asana@localhost:5432/asana
   
   # Application
   DEBUG=true
   ```
   
   **Note**: If you used different credentials, update `DATABASE_URL` accordingly:
   ```
   DATABASE_URL=postgresql+asyncpg://your_user:your_password@localhost:5432/your_database
   ```
   
4. Run database migrations:
   ```bash
   alembic upgrade head
   ```

5. Create a worskspace in terminal with following command as it is not created though APIs
  ```python
  python -c "
  import asyncio
  from app.database import AsyncSessionLocal
  from app.models.workspace import Workspace
  from app.core.security import generate_gid

  async def create_workspace():
      async with AsyncSessionLocal() as session:
          # Create a workspace
          workspace = Workspace(
              gid=generate_gid(),
              name='My Workspace',
              is_organization=False,
          )
          session.add(workspace)
          await session.commit()
          await session.refresh(workspace)
          print(f'Created workspace:')
          print(f'  GID: {workspace.gid}')
          print(f'  Name: {workspace.name}')
          print(f'  Is Organization: {workspace.is_organization}')
          return workspace

  asyncio.run(create_workspace())
  "
  ```

6. Run the application:
```bash
uvicorn app.main:app --reload
```

## API Endpoints (229 Total)

This replica implements **all 229 endpoints** from the Asana API reference documentation.

### Endpoint Summary by Module

| Module | Endpoints | Description |
|--------|-----------|-------------|
| **Tasks** | 27 | Full CRUD, subtasks, dependencies, search |
| **Projects** | 26 | CRUD, memberships, statuses, briefs, templates |
| **Goals** | 23 | CRUD, metrics, relationships, collaborators |
| **Portfolios** | 14 | CRUD, items, memberships, custom fields |
| **App Components** | 12 | Modal forms, rule actions, lookups, widgets |
| **Teams** | 11 | CRUD, memberships, users |
| **Workspaces** | 8 | CRUD, memberships, users |
| **Users** | 8 | Get, update, favorites, team/workspace users |
| **Tags** | 8 | CRUD, workspace tags |
| **Custom Fields** | 8 | CRUD, enum options |
| **Sections** | 8 | CRUD, task organization |
| **Time Tracking** | 6 | Entry management |
| **Memberships** | 5 | Generic membership endpoints |
| **Project Templates** | 5 | Template management |
| **Stories** | 5 | Comments and activity |
| **Webhooks** | 5 | Real-time notifications |
| **Rates** | 5 | Rate management |
| **Allocations** | 5 | Resource allocation |
| **Budgets** | 5 | Budget management |
| **Attachments** | 4 | File uploads |
| **Access Requests** | 4 | Request management |
| **Custom Field Settings** | 4 | Field configuration |
| **Task Templates** | 4 | Template instantiation |
| **Organization Exports** | 3 | Data exports |
| **Events** | 2 | Polling-based changes |
| **Time Periods** | 2 | Goal time periods |
| **User Task Lists** | 2 | My Tasks lists |
| **Exports** | 2 | Graph/resource exports |
| **Custom Types** | 2 | Type definitions |
| **Reactions** | 1 | Emoji reactions |
| **Rules** | 1 | Trigger rules |
| **Audit Logs** | 1 | Activity tracking |
| **Jobs** | 1 | Async job status |
| **Batch API** | 1 | Parallel requests |
| **Typeahead** | 1 | Search suggestions |

### Key Endpoint Examples

#### Users
- `GET /users` - List users
- `GET /users/me` - Get current user
- `GET /users/{gid}` - Get user by GID
- `GET /users/{gid}/favorites` - Get user favorites

#### Workspaces
- `GET /workspaces` - List workspaces
- `GET /workspaces/{gid}` - Get workspace
- `PUT /workspaces/{gid}` - Update workspace
- `POST /workspaces/{gid}/addUser` - Add user to workspace

#### Projects
- `GET /projects` - List projects
- `POST /projects` - Create project
- `GET /projects/{gid}` - Get project
- `PUT /projects/{gid}` - Update project
- `DELETE /projects/{gid}` - Delete project
- `POST /projects/{gid}/duplicate` - Duplicate project

#### Tasks
- `GET /tasks` - List tasks
- `POST /tasks` - Create task
- `GET /tasks/{gid}` - Get task
- `PUT /tasks/{gid}` - Update task
- `DELETE /tasks/{gid}` - Delete task
- `POST /tasks/{gid}/subtasks` - Create subtask
- `GET /tasks/{gid}/dependencies` - Get dependencies
- `GET /workspaces/{gid}/tasks/search` - Search tasks

#### Goals
- `GET /goals` - List goals
- `POST /goals` - Create goal
- `GET /goals/{gid}` - Get goal
- `POST /goals/{gid}/setMetric` - Set goal metric
- `GET /goal_relationships` - Get goal relationships

#### Webhooks
- `GET /webhooks` - List webhooks
- `POST /webhooks` - Establish webhook
- `GET /webhooks/{gid}` - Get webhook
- `DELETE /webhooks/{gid}` - Delete webhook

### Full Documentation

See the complete interactive API documentation at `/docs` (Swagger UI) or `/redoc` (ReDoc) when running the server.

## Running Tests

```bash
# Install test dependencies
pip install pytest pytest-asyncio pytest-cov httpx aiosqlite

# Run tests
pytest tests/ -v

# Run with coverage
pytest tests/ -v --cov=app --cov-report=html
```

## Project Structure

```
scaler-assignment/
├── app/
│   ├── api/
│   │   ├── v1/              # API endpoints
│   │   └── deps.py          # Dependencies
│   ├── core/
│   │   ├── security.py      # Security utilities (GID generation, webhook secrets)
│   │   ├── exceptions.py    # Custom exceptions
│   │   └── events.py        # Event system
│   ├── models/              # SQLAlchemy models
│   ├── schemas/             # Pydantic schemas
│   ├── services/            # Business logic
│   ├── utils/               # Utilities
│   ├── config.py            # Configuration
│   ├── database.py          # Database setup
│   └── main.py              # Application entry
├── alembic/                 # Database migrations
├── tests/                   # Test suite
├── docker-compose.yml
├── Dockerfile
└── requirements.txt
```

## Configuration

### Environment Variables

The application uses environment variables for configuration. Create a `.env` file in the project root with the following variables:

#### Required Variables

- **`DATABASE_URL`** - PostgreSQL connection string
  - Format: `postgresql+asyncpg://user:password@host:port/database`
  - Example: `postgresql+asyncpg://asana:asana@localhost:5432/asana`

#### Optional Variables (with defaults)

- **`DEBUG`** - Enable debug mode (default: `false`)
  - Set to `true` for development (shows detailed error messages)
  - **⚠️ Never set to `true` in production**


